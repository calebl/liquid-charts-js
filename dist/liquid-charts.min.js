this.ChartBuilder=function(){function t(t,e,n){this.set=t,this.chart=e,this.idArray=null!=n?n:[]}return t.colors=["#47a9be","#be5c47","#47be98","#476ebe","#be9847","#be476e","#a9be47","#be47a9","#47be5c"],t.prototype.getIdArray=function(){return this.idArray},t.prototype.processAggregateData=function(e){var n,i,o,r,s,u,c,a,l;return i=this.chart,r=this.getOptions(),a=r.xAxis,l=r.yAxis,n=null,(i.yField.type===Form.FieldTypes.CHOICE||"bar"===i.type)&&(n=a.categories),s=this,u=[],o=[],_.each(e,function(t){return o.push([t.date.valueOf(),t.total])}),c=i.label,u.push({id:c,name:c,color:t.colors[u.length%t.colors.length],data:o}),u},t.prototype.processRecords=function(e){var n,i,o,r,s,u,c,a,l,p;return i=this.chart,u=this.getOptions(),l=u.xAxis,p=u.yAxis,r=t.getFields(e,i.groupByField),o=_.groupBy(r,function(t){return t.groupByValue}),n=null,(i.yField.type===Form.FieldTypes.CHOICE||"bar"===i.type)&&(n=l.categories),c=this,s=this.idArray,a=[],_.each(o,function(e,o){var r,u,l,p,d;if(r=[],"bar"===i.type)if(i.yField.type===Form.FieldTypes.BOOLEAN)r=[0,0];else if(Form.NumericFieldTypes.indexOf(i.yField.type)>-1)r=[0];else if(i.yField.type===Form.FieldTypes.CHOICE)for(u=0;u<n.length;)r.push(0),u++;return _.each(e,function(t){var e,o,s;switch(i.type){case"line":case"scatter":if(o=c.getPoint(t,i.xField,i.yField),null!==o&&!_.isNaN(o.value))return r.push({id:t.id,x:o.x,y:o.y});break;case"bar":if(o=_.findWhere(t.response,{id:i.yField.id}),o&&null!==o&&!_.isNaN(o.value))if(i.yField.type===Form.FieldTypes.BOOLEAN){if(s=Utils.processBooleanStr(o.value),s===!0)return r[0]+=1;if(s===!1)return r[1]+=1}else if(Form.NumericFieldTypes.indexOf(i.yField.type)>-1){if(s=parseFloat(o.value),!_.isNaN(s))return r[0]+=s}else if(i.yField.type===Form.FieldTypes.CHOICE){if(_.isArray(o.value))return _.each(o.value,function(t){var e;return e=n.indexOf(t),e>-1?r[e]+=1:void 0});if(e=n.indexOf(o.value),e>-1)return r[e]+=1}}}),("scatter"===i.type||"line"===i.type)&&(r=_.sortBy(r,function(t){return t.x})),l=!1,i.regressionType&&"none"!==i.regressionType&&(l=!0),d=i.groupByField?t.getSeriesName(i.groupByField,o):i.label,p=[],_.each(r,function(t,e){return p.push(t.id)}),s.push({name:d,ids:p}),r=_.map(r,function(t){return"bar"!==i.type?[t.x,t.y]:[t]}),a.push({id:(new Meteor.Collection.ObjectID).toHexString(),name:d,color:t.colors[a.length%t.colors.length],data:r})}),a},t.prototype.getOptions=function(e){var n,i,o,r,s,u,c,a;switch(u=this.set,n=this.chart,o={title:{text:"",x:-20},credits:{enabled:!1},colors:t.colors},r={},i=n.type,_.isUndefined(i)&&(i="line"),s=this,i){case"bar":r=this.getBarChartOptions(n);break;default:c=t.getAxisInfo(n.xField),a=t.getAxisInfo(n.yField),r={xAxis:c,yAxis:a,plotOptions:{area:{turboThreshold:2500},series:{cursor:"pointer",enableMouseTracking:!0,animation:!1,point:{events:{click:function(){var t;return t=_.findWhere(e,{name:this.series.name}),t?Router.go("showRecord",{_id:u.id,recordNumber:t.ids[this.series.data.indexOf(this)]}):void 0}}},events:{hide:function(){return this.chart.get(this.name+"-regression")?this.chart.get(this.name+"-regression").hide():void 0},show:function(){return this.chart.get(this.name+"-regression")?this.chart.get(this.name+"-regression").show():void 0}}}},tooltip:t.getTooltipFormatter(n.xField,n.yField,c,a),chart:{type:i,zoomType:"x"}}}return _.extend(o,r)},t.getFields=function(t,e){var n;return n=[],_.isUndefined(e)||_.isNull(e)||""===e?n=_.map(t,function(t){return{id:t.recordNumber,createdAt:t.createdAt,response:t.response}}):e&&"liquidUserId"===e.id?n=_.map(t,function(t){return{id:t.recordNumber,groupByValue:t.user.username,createdAt:t.createdAt,response:t.response}}):(n=_.filter(t,function(t){var n;return n=_.findWhere(t.response,{id:e.id}),!_.isUndefined(n)}),n=_.map(n,function(t){return{id:t.recordNumber,groupByValue:_.findWhere(t.response,{id:e.id}).value,createdAt:t.createdAt,response:t.response}})),n},t.prototype.getPoint=function(e,n,i){var o,r;if(o=e.createdAt.valueOf(),!_.isUndefined(n)&&!_.isNull(n)&&""!==n.id){if(o=_.findWhere(e.response,{id:n.id}),!o)return null;o=t.getFieldValue(n.type,o.value)}return(r=_.findWhere(e.response,{id:i.id}))?(r=t.getFieldValue(i.type,r.value),_.isNaN(o)||_.isNaN(r)?null:{x:o,y:r}):null},t.getFieldValue=function(t,e){switch(t){case Form.FieldTypes.NUMBER:case Form.FieldTypes.CALCULATED_SUM:case Form.FieldTypes.LENGTH:case Form.FieldTypes.TEMPERATURE:case Form.FieldTypes.CALCULATED_QUOTIENT:return parseFloat(e);case Form.FieldTypes.DATE:return moment(e).valueOf();case Form.FieldTypes.TIME:return Date.parse("1-1-1 "+e).valueOf()}},t.getSeriesName=function(t,e,n){var i;return null==n&&(n=null),t&&"liquidUserId"===t.id?i=e:(null!==n&&(e=_.findWhere(n.response,{id:t.id}).value),_.isNaN(e)?null:i=t.label+": "+e)},t.prototype.getBarChartOptions=function(e){var n,i,o,r,s,u;switch(u=e.yField,s=e.xField,i=e.groupByField,n=e.aggregateBy,r=t.getAxisInfo(s),o={chart:{type:"column",zoomType:"xy"},yAxis:{min:0,title:{text:u.label,align:"high"},labels:{overflow:"justify"}},xAxis:r,plotOptions:{bar:{dataLabels:{enabled:!0}},series:{animation:!1}},legend:{maxHeight:55},tooltip:{formatter:function(){var t,n,o,r,s,c;if(Form.NumericFieldTypes.indexOf(u.type)>-1)if(e.aggregateBy)switch(n="MMM DD YYYY",r="MMM DD YYYY h:mm a",t=moment.utc(this.x),e.aggregateBy){case"day":o=t.format(n)+": <b>"+this.y+"</b>";break;case"hour":o=t.format(r)+": <b>"+this.y+"</b>";break;default:o=t+": "+this.y}else o=this.x+": "+this.y;else o="<b>"+this.y+"</b> entries",s=_.isUndefined(u.type.options)?"is":"includes",c="<br/>where <b>"+u.label+"</b> "+s+" <b>"+this.x+"</b>","Series 1"!==this.series.name&&(c+=i&&"liquidUserId"===i.id?"<br/>and data submitted by <b>"+this.series.name+"</b>":"<br/>and <b>"+this.series.name+"</b>"),o+=c;return o}}},u.type){case Form.FieldTypes.BOOLEAN:_.extend(o,{xAxis:{categories:["yes","no"],title:{text:null}}});break;case Form.FieldTypes.NUMBER:case Form.FieldTypes.CALCULATED_SUM:case Form.FieldTypes.CALCULATED_QUOTIENT:case Form.FieldTypes.LENGTH:case Form.FieldTypes.TEMPERATURE:_.extend(o,{xAxis:{categories:["total"],title:{text:null}}});break;case Form.FieldTypes.CHOICE:_.extend(o,{xAxis:{categories:_.map(u.options,function(t,e){return t.value}),title:{text:null}}})}return e.aggregateBy&&_.extend(o,{xAxis:{type:"datetime",title:{text:"Time"}}}),o},t.getAxisInfo=function(t){if(_.isNull(t)||_.isUndefined(t)||_.isUndefined(t.id)||""===t.id)return{type:"datetime",title:{text:"Time"}};switch(t.type){case Form.FieldTypes.DATE:return{type:"datetime",title:{text:t.label}};case Form.FieldTypes.TIME:return{type:"datetime",title:{text:t.label},dateTimeLabelFormats:{second:"%l:%M %P",minute:"%l:%M %P",hour:"%l:%M %P",day:"%l:%M %P",week:"%l:%M %P",month:"%l:%M %P",year:"%l:%M %P"}};default:return{type:"linear",title:{text:t.label}}}},t.getTooltipFieldLabel=function(t,e,n){var i,o,r,s;return o="MMM DD YYYY",s="MMM DD YYYY h:mm a",r="h:mm a","datetime"===t?(i=moment.utc(n),e&&e.type===Form.FieldTypes.DATE?e.label+": <b>"+i.format(o)+"</b>":e&&e.type===Form.FieldTypes.TIME?e.label+": <b>"+i.format(r)+"</b>":i.format(s)):e.label+": <b>"+n+"</b>"},t.getTooltipFormatter=function(e,n,i,o){return{formatter:function(){var r,s,u,c,a;if(_.isUndefined(this.series))s="";else if(s="<span><b>"+this.series.name+"</b></span><br/>",this.series.options.isRegressionLine)return r="<span>Equation: "+this.series.options.regressionOutputs.string+"</span><br/>",u="<span>rÂ²: "+this.series.options.regressionOutputs.rSquared+"</span>",s+r+u;return c=t.getTooltipFieldLabel(i.type,e,this.x)+"<br/>",a=t.getTooltipFieldLabel(o.type,n,this.y)+"<br/>",s+c+a}}},t}(),this.Form=function(){function t(){}return t.FieldTypes={NUMBER:"integer",STRING:"string",CHOICE:"choice",PHOTO:"photo",BOOLEAN:"boolean",SECTION:"section",DATE:"date",TIME:"time",LOCATION:"location",LENGTH:"length",TEMPERATURE:"temperature",CALCULATED_SUM:"calculatedSum",CALCULATED_QUOTIENT:"calculatedQuotient"},t.NumericFieldTypes=[t.FieldTypes.NUMBER,t.FieldTypes.LENGTH,t.FieldTypes.TEMPERATURE,t.FieldTypes.CALCULATED_SUM,t.FieldTypes.CALCULATED_QUOTIENT],t}(),function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.Asteroid=e()}(this,function(){"use strict";var t=function(e,n,i,o){t.utils.must.beString(e),this._instanceId=o||"0",this._host=(n?"https://":"http://")+e,this.collections={},this.subscriptions={},this._subscriptionsCache={},this._setDdpOptions(e,n,i),this._init()};t.utils||(t.utils={}),t.utils.btoa=function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=function(e){return t.charAt(e)},n=function(t){for(var e=[],n=0;t>n;n++)e.push(0);return e};return function(t){if("string"==typeof t){var i=t;t=n(i.length);for(var o=0;o<i.length;o++){var r=i.charCodeAt(o);if(r>255)throw new Error("Not ascii. Base64.encode can only take ascii strings");t[o]=r}}for(var s=[],u=null,c=null,a=null,l=null,p=0;p<t.length;p++)switch(p%3){case 0:u=t[p]>>2&63,c=(3&t[p])<<4;break;case 1:c|=t[p]>>4&15,a=(15&t[p])<<2;break;case 2:a|=t[p]>>6&3,l=63&t[p],s.push(e(u)),s.push(e(c)),s.push(e(a)),s.push(e(l)),u=null,c=null,a=null,l=null}return null!==u&&(s.push(e(u)),s.push(e(c)),null===a?s.push("="):s.push(e(a)),null===l&&s.push("=")),s.join("")}}(),t.utils||(t.utils={}),t.utils.clone=function(t){if("undefined"!=typeof EJSON)return EJSON.clone(t);var e=typeof t;switch(e){case"undefined":case"function":return;case"string":case"number":case"boolean":return t;case"object":return null===t?null:JSON.parse(JSON.stringify(t));default:return}},t.utils||(t.utils={}),t.utils.EventEmitter=function(){},t.utils.EventEmitter.prototype={constructor:t.utils.EventEmitter,on:function(t,e){this._events||(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){this._events||(this._events={}),this._events[t]&&this._events[t].splice(this._events[t].indexOf(e),1)},_emit:function(t){if(this._events||(this._events={}),this._events[t]){var e=arguments,n=this;this._events[t].forEach(function(t){t.apply(n,Array.prototype.slice.call(e,1))})}}},t.utils||(t.utils={}),t.utils.getFilterFromSelector=function(e){var n=function(t,e){return e.split(".").reduce(function(t,e){return t?t=t[e]:t},t)},o=Object.keys(e),r=o.map(function(i){var o;return"$and"===i?(o=e[i].map(t.utils.getFilterFromSelector),function(t){return o.reduce(function(e,n){return e?n(t):e},!0)}):"$or"===i?(o=e[i].map(t.utils.getFilterFromSelector),function(t){return o.reduce(function(e,n){return e?e:n(t)},!1)}):"$nor"===i?(o=e[i].map(t.utils.getFilterFromSelector),function(t){return o.reduce(function(e,n){return e?!n(t):e},!0)}):function(t){var o=n(t,i);return o===e[i]}});return function(t){return t._id&&i(t._id)?!1:r.reduce(function(e,n){return e?n(t):e},!0)}},t.utils||(t.utils={}),t.utils.formQs=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n])+"&");return e=e.slice(0,-1)},t.utils||(t.utils={}),t.utils.getOauthState=function(e){var n={loginStyle:"popup",credentialToken:e,isCordova:!1};return t.utils.btoa(JSON.stringify(n))},t.utils||(t.utils={}),t.utils.guid=function(){for(var t="",e=0;8>e;e++)t+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t},t.utils||(t.utils={}),t.utils.isEmail=function(t){return-1!==t.indexOf("@")},t.utils||(t.utils={}),t.utils.isEqual=function(t,e){var n=JSON.stringify(t),i=JSON.stringify(e);return n===i},t.utils||(t.utils={}),t.utils.multiStorage={},t.utils||(t.utils={}),t.utils.must={_toString:function(t){return Object.prototype.toString.call(t).slice(8,-1)},beString:function(t){var e=this._toString(t);if("String"!==e)throw new Error("Assertion failed: expected String, instead got "+e)},beArray:function(t){var e=this._toString(t);if("Array"!==e)throw new Error("Assertion failed: expected Array, instead got "+e)},beObject:function(t){var e=this._toString(t);if("Object"!==e)throw new Error("Assertion failed: expected Object, instead got "+e)}},t.prototype=Object.create(t.utils.EventEmitter.prototype),t.prototype.constructor=t,t.prototype._init=function(){var t=this;t.ddp=new DDP(this._ddpOptions),t.ddp.on("connected",function(){t.resumeLoginPromise=t._tryResumeLogin(),t.subscribe("meteor.loginServiceConfiguration"),t._emit("connected")}),t.ddp.on("reconnected",function(){t.resumeLoginPromise=t._tryResumeLogin(),t._reEstablishSubscriptions(),t._emit("reconnected")}),t.ddp.on("added",function(e){t._onAdded(e)}),t.ddp.on("changed",function(e){t._onChanged(e)}),t.ddp.on("removed",function(e){t._onRemoved(e)})},t.prototype._onAdded=function(e){var n=e.collection;this.collections[n]||(this.collections[n]=new t._Collection(n,this));var i=e.fields||{};i._id=e.id,this.collections[n]._remoteToLocalInsert(i)},t.prototype._onRemoved=function(t){this.collections[t.collection]&&this.collections[t.collection]._remoteToLocalRemove(t.id)},t.prototype._onChanged=function(t){this.collections[t.collection]&&(t.fields||(t.fields={}),t.cleared&&t.cleared.forEach(function(e){t.fields[e]=void 0}),this.collections[t.collection]._remoteToLocalUpdate(t.id,t.fields))},t.prototype.call=function(e){t.utils.must.beString(e);var n=Array.prototype.slice.call(arguments,1);return this.apply(e,n)},t.prototype.apply=function(e,n){t.utils.must.beString(e),Array.isArray(n)||(n=[]);var i=Q.defer(),o=Q.defer(),r=function(t,e){t?(i.reject(t),o.reject()):i.resolve(e)},s=function(){o.resolve()};return this.ddp.method(e,n,r,s),{result:i.promise,updated:o.promise}},t.prototype.getCollection=function(e){return t.utils.must.beString(e),this.collections[e]||(this.collections[e]=new t._Collection(e,this)),this.collections[e]};var e="__del__",n="__upd__",i=function(t){var i=e.length,o=n.length,r=t.slice(-1*i),s=t.slice(-1*o);return r===e||s===n},o=function(t,e){this.name=t,this.asteroid=e,this._set=new s};o.prototype.constructor=o,o.prototype._localToLocalInsert=function(t){if(this._set.contains(t._id))throw new Error("Item "+t._id+" already exists");return this._set.put(t._id,t),Q(t._id)},o.prototype._remoteToLocalInsert=function(t){this._set.put(t._id,t)},o.prototype._localToRemoteInsert=function(t){var e=this,n=Q.defer(),i="/"+e.name+"/insert";return e.asteroid.ddp.method(i,[t],function(i,o){i?(e._set.del(t._id),n.reject(i)):n.resolve(t._id)}),n.promise},o.prototype.insert=function(e){return e._id||(e._id=t.utils.guid()),{local:this._localToLocalInsert(e),remote:this._localToRemoteInsert(e)}},o.prototype._localToLocalRemove=function(t){var n=this._set.get(t);return n&&(this._set.put(t+e,n),this._set.del(t)),Q(t)},o.prototype._remoteToLocalRemove=function(t){this._set.del(t)},o.prototype._localToRemoteRemove=function(t){var n=this,i=Q.defer(),o="/"+n.name+"/remove";return n.asteroid.ddp.method(o,[{_id:t}],function(o,r){if(o){var s=n._set.get(t+e);s&&(n._set.put(t,s),n._set.del(t+e)),i.reject(o)}else n._set.del(t+e),i.resolve(t)}),i.promise},o.prototype.remove=function(t){return{local:this._localToLocalRemove(t),remote:this._localToRemoteRemove(t)}},o.prototype._localToLocalUpdate=function(t,e){var i=this._set.get(t);if(!i)throw new Error("Item "+t+" doesn't exist");if(e._id&&e._id!==t)throw new Error("Modifying the _id of a document is not allowed");this._set.put(t+n,i);for(var o in e)e.hasOwnProperty(o)&&(i[o]=e[o]);return this._set.put(t,i),Q(t)},o.prototype._remoteToLocalUpdate=function(t,e){var n=this._set.get(t);if(!n)return void console.warn("Server misbehaviour: item "+t+" doesn't exist");for(var i in e){if("_id"===i&&e._id!==t)return void console.warn("Server misbehaviour: modifying the _id of a document is not allowed");n[i]=e[i]}this._set.put(t,n)},o.prototype._localToRemoteUpdate=function(t,e){var i=this,o=Q.defer(),r="/"+i.name+"/update",s={_id:t},u={$set:e};return i.asteroid.ddp.method(r,[s,u],function(e,r){if(e){var s=i._set.get(t+n);i._set.put(t,s),i._set.del(t+n),o.reject(e)}else i._set.del(t+n),o.resolve(t)}),o.promise},o.prototype.update=function(t,e){return{local:this._localToLocalUpdate(t,e),remote:this._localToRemoteUpdate(t,e)}};var r=function(t){var e=this;e.result=[],e._set=t,e._getResult(),e._set.on("put",function(t){e._getResult(),e._emit("change",t)}),e._set.on("del",function(t){e._getResult(),e._emit("change",t)})};r.prototype=Object.create(t.utils.EventEmitter.prototype),r.constructor=r,r.prototype._getResult=function(){this.result=this._set.toArray()},o.prototype.reactiveQuery=function(e){var n;n="function"==typeof e?e:t.utils.getFilterFromSelector(e);var i=this._set.filter(n);return new r(i)},t._Collection=o,t.prototype._getOauthClientId=function(t){var e="meteor_accounts_loginServiceConfiguration",n=this.collections[e],i=n.reactiveQuery({service:t}).result[0];return i.clientId||i.consumerKey||i.appId},t.prototype._loginAfterCredentialSecretReceived=function(e){var n=this,i=Q.defer(),o={oauth:e};return n.ddp.method("login",[o],function(e,o){e?(delete n.userId,delete n.loggedIn,t.utils.multiStorage.del(n._host+"__"+n._instanceId+"__login_token__"),i.reject(e),n._emit("loginError",e)):(n.userId=o.id,n.loggedIn=!0,t.utils.multiStorage.set(n._host+"__"+n._instanceId+"__login_token__",o.token),n._emit("login",o.id),i.resolve(o.id))}),i.promise},t.prototype._connectAfterCredentialSecretReceived=function(t){var e=Q.defer(),n={oauth:t};return this.ddp.method("addLoginService",[n],function(t,n){t?e.reject(t):e.resolve()}),e.promise},t.prototype._tryResumeLogin=function(){var e=this;return Q().then(function(){return t.utils.multiStorage.get(e._host+"__"+e._instanceId+"__login_token__")}).then(function(t){if(!t)throw new Error("No login token");return t}).then(function(n){var i=Q.defer(),o={resume:n};return e.ddp.method("login",[o],function(n,o){n?(delete e.userId,delete e.loggedIn,t.utils.multiStorage.del(e._host+"__"+e._instanceId+"__login_token__"),e._emit("loginError",n),i.reject(n)):(e.userId=o.id,e.loggedIn=!0,t.utils.multiStorage.set(e._host+"__"+e._instanceId+"__login_token__",o.token),e._emit("login",o.id),i.resolve(o.id))}),i.promise})},t.prototype.createUser=function(e,n,i){var o,r=this,s=Q.defer();return"string"==typeof e?o={username:t.utils.isEmail(e)?void 0:e,email:t.utils.isEmail(e)?e:void 0,password:n,profile:i}:"object"==typeof e&&(o=e),r.ddp.method("createUser",[o],function(e,n){e?(r._emit("createUserError",e),s.reject(e)):(r.userId=n.id,r.loggedIn=!0,t.utils.multiStorage.set(r._host+"__"+r._instanceId+"__login_token__",n.token),r._emit("createUser",n.id),r._emit("login",n.id),s.resolve(n.id))}),s.promise},t.prototype.loginWithPassword=function(e,n){var i=this,o=Q.defer(),r={password:n,user:{username:t.utils.isEmail(e)?void 0:e,email:t.utils.isEmail(e)?e:void 0}};return i.ddp.method("login",[r],function(e,n){e?(delete i.userId,delete i.loggedIn,t.utils.multiStorage.del(i._host+"__"+i._instanceId+"__login_token__"),o.reject(e),i._emit("loginError",e)):(i.userId=n.id,i.loggedIn=!0,t.utils.multiStorage.set(i._host+"__"+i._instanceId+"__login_token__",n.token),i._emit("login",n.id),o.resolve(n.id))}),o.promise},t.prototype.logout=function(){var e=this,n=Q.defer();return e.ddp.method("logout",[],function(i){i?(e._emit("logoutError",i),n.reject(i)):(delete e.userId,delete e.loggedIn,t.utils.multiStorage.del(e._host+"__"+e._instanceId+"__login_token__"),e._emit("logout"),n.resolve())}),n.promise};var s=function(t){t&&(this._put=this.put,this._del=this.del,this.put=this.del=function(){throw new Error("Attempt to modify readonly set")}),this._items={}};s.prototype=Object.create(t.utils.EventEmitter.prototype),s.constructor=s,s.prototype.put=function(e,n){return t.utils.must.beString(e),t.utils.must.beObject(n),this._items[e]=t.utils.clone(n),this._emit("put",e),this},s.prototype.del=function(e){return t.utils.must.beString(e),delete this._items[e],this._emit("del",e),this},s.prototype.get=function(e){return t.utils.must.beString(e),t.utils.clone(this._items[e])},s.prototype.contains=function(e){return t.utils.must.beString(e),!!this._items[e]},s.prototype.filter=function(e){var n=new s(!0),i=this._items,o=Object.keys(i);return o.forEach(function(o){var r=t.utils.clone(i[o]),s=e(r);s&&(n._items[o]=i[o])}),this.on("put",function(o){var r=t.utils.clone(i[o]),s=e(r);s&&n._put(o,i[o])}),this.on("del",function(t){n._del(t)}),n},s.prototype.toArray=function(){var e=[],n=this._items,i=Object.keys(this._items);return i.forEach(function(t){e.push(n[t])}),t.utils.clone(e)},s.prototype.toHash=function(){return t.utils.clone(this._items)},t.Set=s;var u=function(t,e,n,i){this._name=t,this._params=e,this._fingerprint=n,this._asteroid=i,this._ready=Q.defer(),this.ready=this._ready.promise;var o=this._onReady.bind(this),r=this._onStop.bind(this),s=this._onError.bind(this);this.id=i.ddp.sub(t,e,o,r,s)};return u.constructor=u,u.prototype.stop=function(){this._asteroid.ddp.unsub(this.id),delete this._asteroid._subscriptionsCache[this._fingerprint]},u.prototype._onReady=function(){this._ready.resolve(this.id)},u.prototype._onStop=function(){delete this._asteroid.subscriptions[this.id],delete this._asteroid._subscriptionsCache[this._fingerprint]},u.prototype._onError=function(t){this.ready.isPending()&&this._ready.reject(t),delete this._asteroid.subscriptions[this.id],delete this._asteroid._subscriptionsCache[this._fingerprint]},t.prototype.subscribe=function(e){t.utils.must.beString(e);var n=Array.prototype.slice.call(arguments),i=JSON.stringify(n);if(!this._subscriptionsCache[i]){var o=n.slice(1),r=new u(e,o,i,this);this._subscriptionsCache[r._fingerprint]=r,this.subscriptions[r.id]=r}return this._subscriptionsCache[i]},t.prototype._reEstablishSubscriptions=function(){var t,e,n=this.subscriptions;for(var i in n)n.hasOwnProperty(i)&&(t=n[i],e=new u(t._name,t._params,t._fingerprint,this),delete this.subscriptions[t.id],delete this._subscriptionsCache[t._fingerprint],this.subscriptions[e.id]=e,this._subscriptionsCache[e._fingerprint]=e)},t.prototype._openOauthPopup=function(t,e,n){var i=this,o=window.open(e,"_blank","location=no,toolbar=no");o.focus&&o.focus();var r=Q.defer(),s=JSON.stringify({credentialToken:t}),u=setInterval(function(){o.postMessage(s,i._host)},100);return window.addEventListener("message",function(e){var n;try{n=JSON.parse(e.data)}catch(o){return}e.origin===i._host&&(n.credentialToken===t&&(clearInterval(u),r.resolve({credentialToken:n.credentialToken,credentialSecret:n.credentialSecret})),n.error&&(clearInterval(u),r.reject(n.error)))}),r.promise.then(n.bind(i))},t.utils.multiStorage.get=function(t){var e=Q.defer();return e.resolve(localStorage[t]),e.promise},t.utils.multiStorage.set=function(t,e){var n=Q.defer();return localStorage[t]=e,n.resolve(),n.promise},t.utils.multiStorage.del=function(t){var e=Q.defer();return delete localStorage[t],e.resolve(),e.promise},t.prototype._setDdpOptions=function(t,e,n){"function"==typeof SockJS?this._ddpOptions={endpoint:(e?"https://":"http://")+t+"/sockjs",SocketConstructor:SockJS,socketInterceptFunction:n}:this._ddpOptions={endpoint:(e?"wss://":"ws://")+t+"/websocket",SocketConstructor:WebSocket,socketInterceptFunction:n}},t}),function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.DDP=e()}(this,function(){"use strict";var t=function(){var t=0;return function(){return(t++).toString()}}(),e='{"server_id":"0"}',n=10,i=300,o=1e4,r=["added","changed","connected","error","failed","nosub","ready","removed","result","updated","ping","pong"],s="1",u=function(t){this._endpoint=t.endpoint,this._SocketConstructor=t.SocketConstructor,this._autoreconnect=!t.do_not_autoreconnect,this._ping_interval=t._ping_interval||o,this._socketInterceptFunction=t.socketInterceptFunction,this._onReadyCallbacks={},this._onStopCallbacks={},this._onErrorCallbacks={},this._onResultCallbacks={},this._onUpdatedCallbacks={},this._events={},this._queue=[],this.readyState=-1,this._reconnect_count=0,this._reconnect_incremental_timer=0,t.do_not_autoconnect||this.connect()};return u.prototype.constructor=u,u.prototype.connect=function(){this.readyState=0,this._socket=new this._SocketConstructor(this._endpoint),this._socket.onopen=this._on_socket_open.bind(this),this._socket.onmessage=this._on_socket_message.bind(this),this._socket.onerror=this._on_socket_error.bind(this),this._socket.onclose=this._on_socket_close.bind(this)},u.prototype.method=function(e,n,i,o){var r=t();return this._onResultCallbacks[r]=i,this._onUpdatedCallbacks[r]=o,this._send({msg:"method",id:r,method:e,params:n}),r},u.prototype.sub=function(e,n,i,o,r){var s=t();return this._onReadyCallbacks[s]=i,this._onStopCallbacks[s]=o,this._onErrorCallbacks[s]=r,this._send({msg:"sub",id:s,name:e,params:n}),s},u.prototype.unsub=function(t){return this._send({msg:"unsub",id:t}),t},u.prototype.on=function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)},u.prototype.off=function(t,e){if(this._events[t]){var n=this._events[t].indexOf(e);-1!==n&&this._events[t].splice(n,1)}},u.prototype._emit=function(t){if(this._events[t]){var e=arguments,n=this;this._events[t].forEach(function(t){t.apply(n,Array.prototype.slice.call(e,1))})}},u.prototype._send=function(t){if(1!==this.readyState&&"connect"!==t.msg)return void this._queue.push(t);var e;e="undefined"==typeof EJSON?JSON.stringify(t):EJSON.stringify(t),this._socketInterceptFunction&&this._socketInterceptFunction({type:"socket_message_sent",message:e,timestamp:Date.now()}),this._socket.send(e)},u.prototype._try_reconnect=function(){this._reconnect_count<n?(setTimeout(this.connect.bind(this),this._reconnect_incremental_timer),this._reconnect_count+=1,this._reconnect_incremental_timer+=i*this._reconnect_count):setTimeout(this.connect.bind(this),this._reconnect_incremental_timer)},u.prototype._on_result=function(t){if(this._onResultCallbacks[t.id])this._onResultCallbacks[t.id](t.error,t.result),delete this._onResultCallbacks[t.id],t.error&&delete this._onUpdatedCallbacks[t.id];else if(t.error)throw delete this._onUpdatedCallbacks[t.id],t.error},u.prototype._on_updated=function(t){var e=this;t.methods.forEach(function(t){e._onUpdatedCallbacks[t]&&(e._onUpdatedCallbacks[t](),delete e._onUpdatedCallbacks[t])})},u.prototype._on_nosub=function(t){if(t.error){if(!this._onErrorCallbacks[t.id])throw delete this._onReadyCallbacks[t.id],delete this._onStopCallbacks[t.id],new Error(t.error);return this._onErrorCallbacks[t.id](t.error),delete this._onReadyCallbacks[t.id],delete this._onStopCallbacks[t.id],void delete this._onErrorCallbacks[t.id]}this._onStopCallbacks[t.id]&&this._onStopCallbacks[t.id](),delete this._onReadyCallbacks[t.id],delete this._onStopCallbacks[t.id],delete this._onErrorCallbacks[t.id]},u.prototype._on_ready=function(t){var e=this;t.subs.forEach(function(t){e._onReadyCallbacks[t]&&(e._onReadyCallbacks[t](),delete e._onReadyCallbacks[t])})},u.prototype._on_error=function(t){this._emit("error",t)},u.prototype._on_connected=function(e){var n=this,i=0===n._reconnect_count,o=i?"connected":"reconnected";n.readyState=1,n._reconnect_count=0,n._reconnect_incremental_timer=0;for(var r=n._queue.length,s=0;r>s;s++)n._send(n._queue.shift());n._emit(o,e),n._ping_interval_handle=setInterval(function(){var e=t();n._send({msg:"ping",id:e})},n._ping_interval)},u.prototype._on_failed=function(t){this.readyState=4,this._emit("failed",t)},u.prototype._on_added=function(t){this._emit("added",t)},u.prototype._on_removed=function(t){this._emit("removed",t)},u.prototype._on_changed=function(t){this._emit("changed",t)},u.prototype._on_ping=function(t){this._send({msg:"pong",id:t.id})},u.prototype._on_pong=function(t){},u.prototype._on_socket_close=function(){this._socketInterceptFunction&&this._socketInterceptFunction({type:"socket_close",timestamp:Date.now()}),clearInterval(this._ping_interval_handle),this.readyState=4,this._emit("socket_close"),this._autoreconnect&&this._try_reconnect()},u.prototype._on_socket_error=function(t){this._socketInterceptFunction&&this._socketInterceptFunction({type:"socket_error",error:JSON.stringify(t),timestamp:Date.now()}),clearInterval(this._ping_interval_handle),this.readyState=4,this._emit("socket_error",t)},u.prototype._on_socket_open=function(){this._socketInterceptFunction&&this._socketInterceptFunction({type:"socket_open",timestamp:Date.now()}),this._send({msg:"connect",version:s,support:[s]})},u.prototype._on_socket_message=function(t){this._socketInterceptFunction&&this._socketInterceptFunction({type:"socket_message_received",message:t.data,timestamp:Date.now()});var n;if(t.data!==e){try{if(n="undefined"==typeof EJSON?JSON.parse(t.data):EJSON.parse(t.data),-1===r.indexOf(n.msg))throw new Error}catch(i){return console.warn("Non DDP message received:"),void console.warn(t.data)}this["_on_"+n.msg](n)}},u}),this.Liquid=function(){return{init:function(t,e){this.ssl=e,this.endpoint=t,this.connection=null,this.chartSub=null,this.charts=null,this.connect()},connect:function(){self=this,self.connection=new Asteroid(this.endpoint,this.ssl),self.connection.on("connected",function(){console.log("Connected."),self.charts=self.connection.getCollection("charts")}),self.connection.on("login",function(){}),self.connection.on("logout",function(){console.log("logged out"),self.chartSub.stop()})},initChart:function(t,e,n){var i=$(t),o=self.connection.subscribe("chart",e);o.ready.then(function(t){var o=function(t){if(t.result.length>0){var e=t.result[0],o=new ChartBuilder(e.dataset,e.chart),r=e.idArray,s=o.getOptions(r);e.options&&_.extend(s,e.options),n===!0?i.highcharts("StockChart",s):i.highcharts(s);var u=i.highcharts(),c=e.data;if(c)for(var a=0;a<c.length;a++){var l=c[a],p=l.id,d=u.get(p);d?d.setData(l.data):u.addSeries(l)}}},r=self.charts.reactiveQuery({_id:e});r.on("change",function(t){o(r)}),o(r)},function(t){console.log(t)})}}}(),function(t){if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else Q=t()}(function(){"use strict";function t(t){return function(){return V.apply(t,arguments)}}function e(t){return t===Object(t)}function n(t){return"[object StopIteration]"===et(t)||t instanceof Y}function i(t,e){if(Q&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(nt)){for(var n=[],i=e;i;i=i.source)i.stack&&n.unshift(i.stack);n.unshift(t.stack);var r=n.join("\n"+nt+"\n");t.stack=o(r)}}function o(t){for(var e=t.split("\n"),n=[],i=0;i<e.length;++i){var o=e[i];u(o)||r(o)||!o||n.push(o)}return n.join("\n")}function r(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function s(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(t);return i?[i[1],Number(i[2])]:void 0}function u(t){var e=s(t);if(!e)return!1;var n=e[0],i=e[1];return n===J&&i>=H&&st>=i}function c(){if(Q)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],i=s(n);if(!i)return;return J=i[0],i[1]}}function a(t,e,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e+" is deprecated, use "+n+" instead.",new Error("").stack),t.apply(t,arguments)}}function l(t){return m(t)?t:v(t)?C(t):w(t)}function p(){function t(t){e=t,r.source=t,G(n,function(e,n){W(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,i=void 0}var e,n=[],i=[],o=X(p.prototype),r=X(h.prototype);if(r.promiseDispatch=function(t,o,r){var s=$(arguments);n?(n.push(s),"when"===o&&r[1]&&i.push(r[1])):W(function(){e.promiseDispatch.apply(e,s)})},r.valueOf=function(){if(n)return r;var t=y(e);return m(t)&&(e=t),t},r.inspect=function(){return e?e.inspect():{state:"pending"}},l.longStackSupport&&Q)try{throw new Error}catch(s){r.stack=s.stack.substring(s.stack.indexOf("\n")+1)}return o.promise=r,o.resolve=function(n){e||t(l(n))},o.fulfill=function(n){e||t(w(n))},o.reject=function(n){e||t(E(n))},o.notify=function(t){e||G(i,function(e,n){W(function(){n(t)})},void 0)},o}function d(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");
var e=p();try{t(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}return e.promise}function f(t){return d(function(e,n){for(var i=0,o=t.length;o>i;i++)l(t[i]).then(e,n)})}function h(t,e,n){void 0===e&&(e=function(t){return E(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var i=X(h.prototype);if(i.promiseDispatch=function(n,o,r){var s;try{s=t[o]?t[o].apply(i,r):e.call(i,o,r)}catch(u){s=E(u)}n&&n(s)},i.inspect=n,n){var o=n();"rejected"===o.state&&(i.exception=o.reason),i.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?i:t.value}}return i}function _(t,e,n,i){return l(t).then(e,n,i)}function y(t){if(m(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function m(t){return e(t)&&"function"==typeof t.promiseDispatch&&"function"==typeof t.inspect}function v(t){return e(t)&&"function"==typeof t.then}function g(t){return m(t)&&"pending"===t.inspect().state}function b(t){return!m(t)||"fulfilled"===t.inspect().state}function k(t){return m(t)&&"rejected"===t.inspect().state}function T(){it.length=0,ot.length=0,rt||(rt=!0)}function S(t,e){rt&&(ot.push(t),e&&"undefined"!=typeof e.stack?it.push(e.stack):it.push("(no stack) "+e))}function F(t){if(rt){var e=z(ot,t);-1!==e&&(ot.splice(e,1),it.splice(e,1))}}function E(t){var e=h({when:function(e){return e&&F(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return S(e,t),e}function w(t){return h({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},"delete":function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return tt(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function C(t){var e=p();return W(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}}),e.promise}function x(t){return h({isDef:function(){}},function(e,n){return N(t,e,n)},function(){return l(t).inspect()})}function O(t,e,n){return l(t).spread(e,n)}function I(t){return function(){function e(t,e){var s;if("undefined"==typeof StopIteration){try{s=i[t](e)}catch(u){return E(u)}return s.done?s.value:_(s.value,o,r)}try{s=i[t](e)}catch(u){return n(u)?u.value:E(u)}return _(s,o,r)}var i=t.apply(this,arguments),o=e.bind(e,"next"),r=e.bind(e,"throw");return o()}}function A(t){l.done(l.async(t)())}function R(t){throw new Y(t)}function j(t){return function(){return O([this,U(arguments)],function(e,n){return t.apply(e,n)})}}function N(t,e,n){return l(t).dispatch(e,n)}function U(t){return _(t,function(t){var e=0,n=p();return G(t,function(i,o,r){var s;m(o)&&"fulfilled"===(s=o.inspect()).state?t[r]=s.value:(++e,_(o,function(i){t[r]=i,0===--e&&n.resolve(t)},n.reject,function(t){n.notify({index:r,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function L(t){return _(t,function(t){return t=K(t,l),_(U(K(t,function(t){return _(t,q,q)})),function(){return t})})}function D(t){return l(t).allSettled()}function M(t,e){return l(t).then(void 0,void 0,e)}function P(t,e){return l(t).nodeify(e)}var Q=!1;try{throw new Error}catch(B){Q=!!B.stack}var J,Y,H=c(),q=function(){},W=function(){function t(){for(;e.next;){e=e.next;var n=e.task;e.task=void 0;var o=e.domain;o&&(e.domain=void 0,o.enter());try{n()}catch(s){if(r)throw o&&o.exit(),setTimeout(t,0),o&&o.enter(),s;setTimeout(function(){throw s},0)}o&&o.exit()}i=!1}var e={task:void 0,next:null},n=e,i=!1,o=void 0,r=!1;if(W=function(t){n=n.next={task:t,domain:r&&process.domain,next:null},i||(i=!0,o())},"undefined"!=typeof process&&process.nextTick)r=!0,o=function(){process.nextTick(t)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=function(){o=u,s.port1.onmessage=t,t()};var u=function(){s.port2.postMessage(0)};o=function(){setTimeout(t,0),u()}}else o=function(){setTimeout(t,0)};return W}(),V=Function.call,$=t(Array.prototype.slice),G=t(Array.prototype.reduce||function(t,e){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;i>n;n++)n in this&&(e=t(e,this[n],n));return e}),z=t(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),K=t(Array.prototype.map||function(t,e){var n=this,i=[];return G(n,function(o,r,s){i.push(t.call(e,r,s,n))},void 0),i}),X=Object.create||function(t){function e(){}return e.prototype=t,new e},Z=t(Object.prototype.hasOwnProperty),tt=Object.keys||function(t){var e=[];for(var n in t)Z(t,n)&&e.push(n);return e},et=t(Object.prototype.toString);Y="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var nt="From previous event:";l.resolve=l,l.nextTick=W,l.longStackSupport=!1,l.defer=p,p.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):arguments.length>2?t.resolve($(arguments,1)):t.resolve(n)}},l.Promise=d,l.promise=d,d.race=f,d.all=U,d.reject=E,d.resolve=l,l.passByCopy=function(t){return t},h.prototype.passByCopy=function(){return this},l.join=function(t,e){return l(t).join(e)},h.prototype.join=function(t){return l([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},l.race=f,h.prototype.race=function(){return this.then(l.race)},l.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(t,e,n){function o(e){try{return"function"==typeof t?t(e):e}catch(n){return E(n)}}function r(t){if("function"==typeof e){i(t,u);try{return e(t)}catch(n){return E(n)}}return E(t)}function s(t){return"function"==typeof n?n(t):t}var u=this,c=p(),a=!1;return W(function(){u.promiseDispatch(function(t){a||(a=!0,c.resolve(o(t)))},"when",[function(t){a||(a=!0,c.resolve(r(t)))}])}),u.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=s(t)}catch(i){if(n=!0,!l.onerror)throw i;l.onerror(i)}n||c.notify(e)}]),c.promise},l.when=_,h.prototype.thenResolve=function(t){return this.then(function(){return t})},l.thenResolve=function(t,e){return l(t).thenResolve(e)},h.prototype.thenReject=function(t){return this.then(function(){throw t})},l.thenReject=function(t,e){return l(t).thenReject(e)},l.nearer=y,l.isPromise=m,l.isPromiseAlike=v,l.isPending=g,h.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=b,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=k,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var it=[],ot=[],rt=!0;l.resetUnhandledRejections=T,l.getUnhandledReasons=function(){return it.slice()},l.stopUnhandledRejectionTracking=function(){T(),rt=!1},T(),l.reject=E,l.fulfill=w,l.master=x,l.spread=O,h.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},l.async=I,l.spawn=A,l["return"]=R,l.promised=j,l.dispatch=N,h.prototype.dispatch=function(t,e){var n=this,i=p();return W(function(){n.promiseDispatch(i.resolve,t,e)}),i.promise},l.get=function(t,e){return l(t).dispatch("get",[e])},h.prototype.get=function(t){return this.dispatch("get",[t])},l.set=function(t,e,n){return l(t).dispatch("set",[e,n])},h.prototype.set=function(t,e){return this.dispatch("set",[t,e])},l.del=l["delete"]=function(t,e){return l(t).dispatch("delete",[e])},h.prototype.del=h.prototype["delete"]=function(t){return this.dispatch("delete",[t])},l.mapply=l.post=function(t,e,n){return l(t).dispatch("post",[e,n])},h.prototype.mapply=h.prototype.post=function(t,e){return this.dispatch("post",[t,e])},l.send=l.mcall=l.invoke=function(t,e){return l(t).dispatch("post",[e,$(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(t){return this.dispatch("post",[t,$(arguments,1)])},l.fapply=function(t,e){return l(t).dispatch("apply",[void 0,e])},h.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},l["try"]=l.fcall=function(t){return l(t).dispatch("apply",[void 0,$(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,$(arguments)])},l.fbind=function(t){var e=l(t),n=$(arguments,1);return function(){return e.dispatch("apply",[this,n.concat($(arguments))])}},h.prototype.fbind=function(){var t=this,e=$(arguments);return function(){return t.dispatch("apply",[this,e.concat($(arguments))])}},l.keys=function(t){return l(t).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},l.all=U,h.prototype.all=function(){return U(this)},l.allResolved=a(L,"allResolved","allSettled"),h.prototype.allResolved=function(){return L(this)},l.allSettled=D,h.prototype.allSettled=function(){return this.then(function(t){return U(K(t,function(t){function e(){return t.inspect()}return t=l(t),t.then(e,e)}))})},l.fail=l["catch"]=function(t,e){return l(t).then(void 0,e)},h.prototype.fail=h.prototype["catch"]=function(t){return this.then(void 0,t)},l.progress=M,h.prototype.progress=function(t){return this.then(void 0,void 0,t)},l.fin=l["finally"]=function(t,e){return l(t)["finally"](e)},h.prototype.fin=h.prototype["finally"]=function(t){return t=l(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},l.done=function(t,e,n,i){return l(t).done(e,n,i)},h.prototype.done=function(t,e,n){var o=function(t){W(function(){if(i(t,r),!l.onerror)throw t;l.onerror(t)})},r=t||e||n?this.then(t,e,n):this;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),r.then(void 0,o)},l.timeout=function(t,e,n){return l(t).timeout(e,n)},h.prototype.timeout=function(t,e){var n=p(),i=setTimeout(function(){n.reject(new Error(e||"Timed out after "+t+" ms"))},t);return this.then(function(t){clearTimeout(i),n.resolve(t)},function(t){clearTimeout(i),n.reject(t)},n.notify),n.promise},l.delay=function(t,e){return void 0===e&&(e=t,t=void 0),l(t).delay(e)},h.prototype.delay=function(t){return this.then(function(e){var n=p();return setTimeout(function(){n.resolve(e)},t),n.promise})},l.nfapply=function(t,e){return l(t).nfapply(e)},h.prototype.nfapply=function(t){var e=p(),n=$(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},l.nfcall=function(t){var e=$(arguments,1);return l(t).nfapply(e)},h.prototype.nfcall=function(){var t=$(arguments),e=p();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},l.nfbind=l.denodeify=function(t){var e=$(arguments,1);return function(){var n=e.concat($(arguments)),i=p();return n.push(i.makeNodeResolver()),l(t).fapply(n).fail(i.reject),i.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var t=$(arguments);return t.unshift(this),l.denodeify.apply(void 0,t)},l.nbind=function(t,e){var n=$(arguments,2);return function(){function i(){return t.apply(e,arguments)}var o=n.concat($(arguments)),r=p();return o.push(r.makeNodeResolver()),l(i).fapply(o).fail(r.reject),r.promise}},h.prototype.nbind=function(){var t=$(arguments,0);return t.unshift(this),l.nbind.apply(void 0,t)},l.nmapply=l.npost=function(t,e,n){return l(t).npost(e,n)},h.prototype.nmapply=h.prototype.npost=function(t,e){var n=$(e||[]),i=p();return n.push(i.makeNodeResolver()),this.dispatch("post",[t,n]).fail(i.reject),i.promise},l.nsend=l.nmcall=l.ninvoke=function(t,e){var n=$(arguments,2),i=p();return n.push(i.makeNodeResolver()),l(t).dispatch("post",[e,n]).fail(i.reject),i.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(t){var e=$(arguments,1),n=p();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},l.nodeify=P,h.prototype.nodeify=function(t){return t?void this.then(function(e){W(function(){t(null,e)})},function(e){W(function(){t(e)})}):this};var st=c();return l});